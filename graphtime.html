<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <title>Line (using curveCardinal)</title>
</head>

<style>
    path {
        fill: none;
        stroke: #999;
    }
    circle {
        fill: none;
        stroke: none;
    }
    .x.axis path {
        display: none;
    }
</style>

<body>

<div align="left" margin-t>
<svg width="800" height="200">
    <path></path>
</svg>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
<script>
    var lineGenerator = d3.line()
        .curve(d3.curveCardinal);


/*
        {
            x:[0,100,200,300,400,500],
            y:[0,0,0,0,0,0]
        },
        {
            x:[0,100,200,300,400,500],
            y:[30,40,30,50,40,10]
        },
        {
            x:[0,100,200,300,400,500],
            y:[80,60,50,60,60,90]
        },

        {
            x:[0,100,200,300,400,500],
            y:[100,100,100,100,100,100]
        }
    ];

*/


    function createArray(number){
        var k = []
        for (var i =0; i < number; i++){
        k.push(i * 5  );
        }
        return k;
    }
    width = 500;
    height = 120;
    var svg = d3.select("body")
        .append("svg")
        .attr("width", width + 200)
        .attr("height", height);

    d3.csv("tweets.csv", function (data) {




        var dataPoints = [];
        var ex = [];
        var ey = [];
        for (var i = 0; i < data.length; i++) {
            var tot = parseInt(data[i].dem) + parseInt(data[i].rep);
            ex.push(Math.floor(100 * parseInt(data[i].dem) / tot));
            ey.push(Math.floor(100 - 100 * parseInt(data[i].rep) / tot));
        }
        console.log(ex);
        dataPoints.push({
            x: createArray(data.length),
            y: Array.apply(null, Array(data.length)).map(Number.prototype.valueOf, 0)});

        dataPoints.push(
            {
                x: createArray(data.length),
            y:ex});

        dataPoints.push(
            {
                x: createArray(data.length),
            y: ey});
        dataPoints.push(
            {
                x: createArray(data.length),
            y: Array.apply(null, Array(data.length)).map(Number.prototype.valueOf, 100)
    })
        ;



    var indexies = d3.range( dataPoints[0].x.length);

    var area = d3.area()
        .x0( function(d) { return dataPoints[0].x[d] } )
        .x1( function(d) { return dataPoints[1].x[d] } )
        .y0( function(d) { return dataPoints[0].y[d] } )
        .y1(  function(d) { return dataPoints[1].y[d] } )
        .curve(d3.curveCardinal);

    var area2 = d3.area()
        .x0( function(d) { return dataPoints[1].x[d] } )
        .x1( function(d) { return dataPoints[2].x[d] } )
        .y0( function(d) { return dataPoints[1].y[d] } )
        .y1(  function(d) { return dataPoints[2].y[d] } )
        .curve(d3.curveCardinal);

    var area3 = d3.area()
        .x0( function(d) { return dataPoints[2].x[d] } )
        .x1( function(d) { return dataPoints[3].x[d] } )
        .y0( function(d) { return dataPoints[2].y[d] } )
        .y1(  function(d) { return dataPoints[3].y[d] } )
        .curve(d3.curveCardinal);

    svg.append('path')
        .datum(indexies)
        .attr('class', 'area')
        .attr('fill', 'red')
        .attr('d', area)
        .style("fill",'#5974ff');
    svg.append('path')
        .datum(indexies)
        .attr('class', 'area')
        .attr('fill', 'green')
        .attr('d', area2)
        .style("fill",'#ecf771');
    svg.append('path')
        .datum(indexies)
        .attr('class', 'area')
        .attr('fill', 'blue')
        .attr('d', area3)
        .style("fill",'#E91D0E');
    var focus = svg.append("g")
        .attr("class", "circle")
        .style("display", "none");

    focus.append("circle")
        .attr("r", 4.5);

    focus.append("text")
        .attr("x", 9)
        .attr("dy", ".35em");
    //Draw lines
        console.log(dataPoints);
    for (let i = 0; i < dataPoints.length; i++){
        console.log("DD");
        svg.append('path')
            .attr("d",lineGenerator(d3.zip(dataPoints[i].x, dataPoints[i].y)));
    }

    function minDistance(value, array){
        map1 = array.map(a => Math.abs(a - value));
        return Math.min(...map1);
    }

    function minIndex(value, array){
        map1 = array.map(a => Math.abs(a - value));
        return map1.indexOf(Math.min(...map1));
    }

        svg.on("mouseover", function() { focus.style("display", null);})
            .on("mouseout", function() { focus.style("display", "none");})
            .on("mousemove", mousemove);


        function mousemove() {
            var coordinates = d3.mouse(this);
            var dist = minDistance(coordinates[0], dataPoints[0].x);
            var ind = minIndex(coordinates[0], dataPoints[0].x);
            if (dist < 10){
                //focus.select("text").text(coordinates[0] + "," + coordinates[1]);
                focus.select("text").text("R: " + (100 - dataPoints[2].y[ind]) +  "D: " +  dataPoints[1].y[ind]);
                focus.select('r',4.5);
            }
            else{
                focus.select("text").text("");
                focus.select('r',0);
            }
            focus.attr("transform", "translate(" + coordinates[0] + "," + coordinates[1] + ")");


        }


    });
</script>
</body>
</html>